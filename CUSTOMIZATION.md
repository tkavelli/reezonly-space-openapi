# Руководство по кастомизации документации (Redocly + Scripts)

В этом проекте используется гибридный подход к кастомизации:
1.  **Визуал (HTML/CSS):** Redocly Config (v2) + JS пост-обработка (логотип, фавикон, шрифты).
2.  **Контент (OpenAPI):** Node.js скрипт сборки для фильтрации и группировки методов.

---

## 1. Конфигурация темы (`redocly.yaml`)

Мы используем **Redocly CLI v2**. Основные настройки темы находятся в секции `openapi`.

```yaml
# Глобальные настройки (вне openapi)
logo:
  image: /img/logo.svg # Абсолютный путь для корректной работы сервера из docs/
  altText: Reezonly Space

# Настройки генерации документации
openapi:
  theme:
    # Размеры логотипа (сам файл подключается отдельно, см. ниже)
    logo:
      gutter: 16px
      maxHeight: 40px
    
    # Цвета интерфейса
    colors:
      primary:
        main: '#514df7'
      text:
        primary: '#1f2430'
        secondary: '#4b5565'
    
    # Настройки боковой панели (прямые потомки theme, не colors!)
    sidebar:
      width: 280px
      backgroundColor: '#eff1f8'
    
    rightPanel:
      width: 40%
      backgroundColor: '#0f172a'
      textColor: '#e2e8f0'
    
    # Шрифты (названия семейств)
    typography:
      fontFamily: 'StyreneALC, "Inter", sans-serif'
      headings:
        fontFamily: 'StyreneALC, "Inter", sans-serif'
        fontWeight: '700' # Строковое значение обязательно!
```

---

## 2. JS Пост-обработка и Логотип (`tools/add-try-link.js`)

Из-за особенностей статической сборки Redocly, некоторые элементы (логотип, фавикон, шрифты) внедряются скриптом **после** генерации HTML. Скрипт запускается автоматически командой `npm run build-docs`.

### Что делает скрипт:

1.  **Копирование логотипа:**
    *   Копирует физический файл из `img/logo.svg` (корень проекта) в `docs/img/logo.svg`. Это критично для деплоя.

2.  **Принудительная вставка логотипа (JS Injection):**
    *   Внедряет JS-код в `index.html`, который проверяет наличие логотипа в DOM.
    *   Если Redoc не сгенерировал тег `<img>` (частая проблема в v2), скрипт **создает его вручную** и вставляет в начало сайдбара (`.menu-content`).
    *   Использует путь `img/logo.svg` и alt-текст `Reezonly Space`.

3.  **Заголовок "Space Platform":**
    *   Добавляет текстовый заголовок рядом с логотипом.

4.  **Шрифты и Фавикон:**
    *   Подключает `docs/fonts.css` и `docs/favicon.png`.

---

## 3. Структура API и Группировка (`tools/build.js`)

Это "мозг" сборки контента. Мы не редактируем единый файл вручную.

1.  **Сборка:** Объединяет `specs/core/base.yaml` и модули (`users`, `groups` и т.д.) в один файл.
2.  **Фильтрация:** Оставляет **только 45 публичных методов** (жестко заданный `allowed` список).
3.  **Tag Groups (Меню слева):** Генерирует объект `x-tagGroups`. Именно здесь определяются разделы меню ("Users", "Groups", "Certificates").

---

## 4. Ассеты (Где что лежит)

*   `img/logo.svg` — Исходный логотип проекта.
*   `docs/img/logo.svg` — Копия логотипа для сайта (создается автоматически).
*   `docs/fonts/` — Файлы шрифтов.
*   `docs/fonts.css` — CSS для подключения шрифтов.
*   `docs/favicon.png` — Иконка.

## 5. Команда сборки

Чтобы применить ВСЕ изменения (контент, конфиг темы, скрипты, копирование файлов):

```bash
npm run build-docs
```

Для локального просмотра результата:
```bash
npx serve -l 3000 docs
```
