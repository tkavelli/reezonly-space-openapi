openapi: 3.1.0
info:
  title: Reezonly Space Platform API
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  description: |
    **Руководство интеграций Reezonly Space** — это главный источник информации, благодаря которому внешние CRM, CMS, ERP и маркетинговые системы быстро подключают программный доступ к Space API.

    Здесь собраны схемы аутентификации, бизнес‑блоки пользователей, групп, курсов, сертификатов и отчетов, примеры запросов и схемы ответов. Документация рассказывает, как синхронизировать пользователей, подтянуть группы и права из вашей CRM, создавать курсы и выгружать отчеты — все через безопасный `X-API-Key` и понятные бизнес-сущности.

    ## Обзор платформы

    - **Управление пользователями** — группы с вложенностью, сегментация, импорт, лимиты
    - **CMS** — конструктор лендингов, страниц, меню, SEO
    - **Платёжный шлюз** — приём платежей (ЮMoney, Robokassa)
    - **Маркетинг** — email-рассылки (13 системных событий), формы, wait-list
    - **Сертификаты** — генерация PDF-документов
    - **Каталог курсов** — витрина (контент курсов в LMS)
    - **Интеграция с LMS** — iframe, webhook, API для курсов

    ## Аутентификация

    Для доступа к API необходимо использовать **API Key** в заголовке запроса:

    ```
    X-API-Key: your_api_key_here
    ```

    ## Базовый URL

    ```
    https://your-space-domain.com/api/v1
    ```
servers:
  - url: https://your-space-domain.com/api/v1
    description: Production server
  - url: https://staging-space-domain.com/api/v1
    description: Staging server
security:
  - ApiKeyAuth: []
tags:
  - name: Users.Operations
    description: |
      ## Базовые операции с пользователями

      **Назначение:** CRUD для пользователей, управление статусами и ролями.
      **Ключевые особенности:**
      - Фильтрация по `status` (int), `role`, `department`.
      - Поддержка кастомных полей в `view` и `update`.
      - Асинхронное создание (через очередь).
  - name: Users.Courses
    description: |
      ## Управление курсами пользователя

      **Назначение:** назначение и отзыв курсов.
      **Особенности:** методы `add-course` и `delete-course` работают асинхронно.
  - name: Users.Import
    description: |
      ## Импорт пользователей

      **Назначение:** массовая загрузка пользователей из Excel.
      **Процесс:** `load-template` -> `preview` -> `load` (commit) -> `get-import-progress`.
  - name: Users.Fields
    description: |
      ## Кастомные поля

      **Назначение:** работа с дополнительными атрибутами профиля (`UserFieldKey`).
  - name: Groups.Structure
    description: |
      ## Структура и иерархия групп

      **Назначение:** выстроить иерархию корпоративных групп с поддержкой вложенности, фильтрации и синхронизации с продуктами/ролями.
      **Ключевые особенности:**
      - Родительские связи, проверка циклов, фильтры по статусу/group type и `PaginationMeta`.
      - Используются схемы `Group`, `GroupListItem` и стандартные ответы на ошибки.
      **Пример Use case:** интегратор CRM подстраивает дерево отделов: получает групповой каталог, создаёт новый подраздел с `POST /group/group/create`, затем проверяет структуру через `/group/group/view`.
  - name: Groups.Members
    description: |
      ## Управление участниками групп

      **Назначение:** массово добавлять/удалять пользователей и назначать курсы для групп на стороне интеграции.
      **Ключевые особенности:** простые payload’ы (`user_id`, `course_ids`, списки `ids[]`), поддержка экспорта, `assign-courses` для курсов, `DELETE /multiple-delete`.
      **Пример Use case:** HR переносит 50 сотрудников между группами, одновременно обновляя назначенные курсы через `POST /group/group/assign-courses`, а затем скачивает экспорт структуры (`/group/group/export`).
  - name: Certificates.Templates
    description: |
      Управление шаблонами для генерации PDF сертификатов: внешний вид, расположение элементов и переменные для подстановки данных (read-only).
  - name: Certificates.Issued
    description: |
      Управление выданными сертификатами, их статусами и верификацией.
  - name: Certificates.Lookups
    description: |
      Справочники и системные настройки, связанные с сертификатами.
  - name: Courses
    description: |
      Курсы и обучающие продукты (read-only). Назначение: отдать актуальные метаданные курсов и продуктов для витрин/CRM/маркетинга. Ключевые особенности: постраничная выдача (`/course/course/index`), структура и уроки, атрибуты активности (`students_count`, `enabled`, `status`, `picture`, `lms_id`). Пример: внешняя CMS запрашивает `/course/course/index`, показывает карточки, затем `/course/course/view` для программы и уроков.
  - name: Pages
    description: |
      Страницы и контент сайта (read-only). Назначение: раскрыть структуру публичных/закрытых страниц для внешних CMS. Ключевые особенности: список типов (`/dictionary/dictionary/page-types`), выдача `pages`, поля `enabled`, SEO-метаданные, `alias`, `category`. Пример: внешняя система берёт меню, вызывает `/dictionary/dictionary/pages`, сортирует по типу, обновляет ссылки без доступа к внутренней CMS.
  - name: Integration Reports
    description: |
      ## Отчеты для интеграционных систем

      Генерация данных «Сводного» отчёта в JSON для BI/дашбордов без генерации файлов.
paths:
  /user/user/index:
    get:
      tags:
        - Users.Operations
      operationId: listUsers
      summary: Получить список пользователей
      description: |
        Возвращает список пользователей с пагинацией и расширенными фильтрами.
        Поддерживает сортировку и фильтрацию по группам, курсам и сумме оплат.
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - name: username
          in: query
          schema:
            type: string
          description: Поиск по имени или email
        - name: status
          in: query
          description: 'Статус: 0=New, 10=Active, 20=Blocked, 30=Unconfirmed'
          schema:
            type: integer
            enum:
              - 0
              - 10
              - 20
              - 30
        - name: position
          in: query
          schema:
            type: string
          description: Фильтр по должности
        - name: department
          in: query
          schema:
            type: string
          description: Фильтр по отделу
        - name: groupIds
          in: query
          schema:
            type: array
            items:
              type: integer
          description: Фильтр по ID групп
        - name: courseIds
          in: query
          schema:
            type: array
            items:
              type: integer
          description: Фильтр по ID курсов (имеет доступ)
        - name: sort
          in: query
          schema:
            type: string
            default: '-updated_at'
            example: '-created_at'
          description: 'Поле сортировки: username, email, position, department, status, courseCount, created_at, updated_at, payment_sum. Префикс ''-'' для убывания.'
      responses:
        '200':
          description: Список пользователей
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/UserListItem'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /user/user/admin:
    get:
      tags:
        - Users.Operations
      operationId: listAdminUsers
      summary: Получить список администраторов
      description: Аналогичен методу index, но возвращает только пользователей с правами администратора.
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - name: username
          in: query
          description: Поиск по имени или email
          schema:
            type: string
        - name: sort
          in: query
          description: Поле сортировки
          schema:
            type: string
            default: '-updated_at'
      responses:
        '200':
          description: Список администраторов
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/UserListItem'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /user/user/view:
    get:
      tags:
        - Users.Operations
      operationId: getUser
      summary: Получить профиль пользователя
      description: Возвращает детальную информацию о пользователе, включая курсы, сертификаты и кастомные поля.
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Профиль пользователя
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          item:
                            $ref: '#/components/schemas/UserDetail'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /user/user/create:
    post:
      tags:
        - Users.Operations
      operationId: createUser
      summary: Создать пользователя
      description: |
        Создает нового пользователя. Пароль обязателен.
        Привязка к группам и курсам при создании не поддерживается (используйте отдельные методы).
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UserCreateForm'
      responses:
        '201':
          description: Пользователь успешно создан
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user_id:
                            type: integer
                            example: 1
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /user/user/update:
    put:
      tags:
        - Users.Operations
      operationId: updateUser
      summary: Обновить пользователя
      description: Обновляет данные профиля, включая кастомные поля.
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UserUpdateForm'
      responses:
        '200':
          description: Пользователь обновлен
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user_id:
                            type: integer
                            example: 1
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /user/user/delete:
    delete:
      tags:
        - Users.Operations
      operationId: deleteUser
      summary: Удалить пользователя(ей)
      description: Удаляет одного или нескольких пользователей.
      parameters:
        - name: ids
          in: query
          schema:
            type: array
            items:
              type: integer
          description: Массив ID пользователей для удаления (опционально, если не передано - ошибка?)
      responses:
        '200':
          description: Успешное удаление
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /dictionary/user/fields:
    get:
      tags:
        - Users.Fields
      operationId: listUserFields
      summary: Получить список кастомных полей
      description: Возвращает конфигурацию дополнительных полей профиля пользователя.
      security:
        - BearerToken: []
      responses:
        '200':
          description: Список полей
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserFieldDefinition'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /dictionary/user/statuses:
    get:
      tags:
        - Users.Operations
      operationId: listUserStatuses
      summary: Справочник статусов
      description: Возвращает список всех возможных статусов пользователей (New, Active, Blocked, Unconfirmed) с их ID для использования в фильтрах и при создании пользователей.
      security:
        - BearerToken: []
      responses:
        '200':
          description: Список статусов
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        name:
                          type: string
                          example: John Doe
        '401':
          $ref: '#/components/responses/Unauthorized'
  /user/user/add-course:
    post:
      tags:
        - Users.Courses
      operationId: assignUserCourse
      summary: Назначить курс пользователю
      description: Назначает один или несколько курсов одному или нескольким пользователям. Операция выполняется асинхронно. Если пользователь уже имеет доступ к курсу, отметка `new=false` указывает на существующее назначение.
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/AddCourseForm'
      responses:
        '200':
          description: Курс назначен
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        userId:
                          type: integer
                          example: 1
                        courseId:
                          type: integer
                          example: 1
                        result:
                          type: boolean
                          example: true
                        new:
                          type: boolean
                          example: true
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /user/user/delete-course:
    post:
      tags:
        - Users.Courses
      operationId: deleteUserCourse
      summary: Отозвать курс у пользователя
      description: Удаляет доступ одного или нескольких пользователей к одному или нескольким курсам. После удаления прогресс прохождения курса сохраняется, но пользователь больше не может получать доступ к материалам и выполнять задания курса.
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/AddCourseForm'
      responses:
        '200':
          description: Курс отозван
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  results:
                    type: integer
                    description: Количество удаленных записей
                    example: 1
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /user/user/load-template:
    get:
      tags:
        - Users.Import
      operationId: downloadUserImportTemplate
      summary: Скачать шаблон импорта (XLSX)
      description: Возвращает Excel-шаблон для массового импорта пользователей. Содержит необходимые колонки (username, email, password, department, position и др.) с примерами и подсказками. Используйте этот файл как основу для подготовки данных к импорту.
      security:
        - BearerToken: []
      responses:
        '200':
          description: Файл шаблона
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
        '500':
          $ref: '#/components/responses/InternalError'
  /user/user/preview:
    post:
      tags:
        - Users.Import
      operationId: getUserImportPreview
      summary: Предварительный просмотр импорта
      description: Валидирует загруженный файл и показывает предварительный просмотр данных, которые будут импортированы. Помогает обнаружить ошибки в формате или содержимом перед фактическим импортом. Возвращает список строк и ошибок валидации для каждой записи.
      security:
        - BearerToken: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                fileImport:
                  type: string
                  format: binary
                  example: example
                updateMode:
                  type: boolean
                  example: true
      responses:
        '200':
          description: Результат превью
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          preview:
                            type: object
                            description: Структура превью (строки, ошибки)
        '500':
          $ref: '#/components/responses/InternalError'
  /user/user/load:
    post:
      tags:
        - Users.Import
      operationId: createUserImport
      summary: Запустить импорт
      description: Запускает асинхронный процесс импорта пользователей из загруженного файла. Возвращает `jobId` для отслеживания прогресса и `reportKey` для получения результатов. Используйте метод `get-import-progress` для мониторинга и получения финального отчета.
      security:
        - BearerToken: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                fileImport:
                  type: string
                  format: binary
                  example: example
                updateMode:
                  type: boolean
                  example: true
      responses:
        '200':
          description: Задача создана
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          jobId:
                            type: integer
                            example: 1
                          reportKey:
                            type: string
                            example: example
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /user/user/get-import-progress:
    get:
      tags:
        - Users.Import
      operationId: getUserImportProgress
      summary: Получить прогресс импорта
      description: Возвращает текущий статус и прогресс импорта пользователей. Параметр `id` должен содержать `reportKey` из ответа метода `load`. По завершении импорта включает финальный отчет с результатами (количество успешно импортированных, ошибки, предупреждения).
      security:
        - BearerToken: []
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
          description: Report Key из метода load
      responses:
        '200':
          description: Прогресс
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          progress:
                            type: integer
                            example: 1
                          report:
                            type:
                              - object
                              - 'null'
        '404':
          $ref: '#/components/responses/NotFound'
  /user/import-report/index:
    get:
      tags:
        - Users.Import
      operationId: listUserImportReports
      summary: История импортов
      description: Возвращает список всех выполненных импортов пользователей с пагинацией. Каждый отчет содержит информацию о дате импорта, количестве обработанных записей, количестве ошибок и результатах. Используйте метод `downloadUserImportReport` для получения детального отчета в формате Excel.
      security:
        - BearerToken: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - name: type
          in: query
          schema:
            type: integer
          description: Фильтр по типу отчета
      responses:
        '200':
          description: Список отчетов
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/ImportReport'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /user/importreport/download:
    get:
      tags:
        - Users.Import
      operationId: downloadUserImportReport
      summary: Скачать отчет об импорте
      description: Возвращает детальный отчет об импорте в формате Excel. Отчет содержит информацию о каждой обработанной строке (успех/ошибка), данные пользователя и результат обработки. Используйте ID отчета из метода `listUserImportReports`.
      security:
        - BearerToken: []
      parameters:
        - name: id
          in: query
          description: ID отчета об импорте
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Файл отчета
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
        '500':
          $ref: '#/components/responses/InternalError'
  /group/group/index:
    get:
      tags:
        - Groups.Structure
      operationId: listGroups
      summary: Получить список групп
      description: |
        Возвращает список групп (без пагинации).
        Поддерживаются фильтры по `id`, `parent_id`, строке поиска и флагу `showDefault` (0/1).
        Сортировка задаётся параметром `sort` (например, `sort=updated_at` или `sort=-updated_at`).
      parameters:
        - name: id
          in: query
          schema:
            type: integer
            minimum: 1
          description: ID группы
          example: 12
        - name: parent_id
          in: query
          schema:
            type: integer
            minimum: 1
          description: ID родительской группы; если не указан — выводятся все корневые
          example: 10
        - name: search
          in: query
          schema:
            type: string
            maxLength: 255
          description: Поиск по названию или описанию группы
          example: Sales
        - name: sort
          in: query
          schema:
            type: string
            enum:
              - id
              - '-id'
              - search
              - '-search'
              - updated_at
              - '-updated_at'
              - userCount
              - '-userCount'
            default: '-updated_at'
          description: Поле сортировки (префикс `-` для убывания)
          example: '-updated_at'
        - name: showDefault
          in: query
          schema:
            type: integer
            enum:
              - 0
              - 1
            default: 0
          description: Показывать системные группы (guest/authorized)
          example: 0
      responses:
        '200':
          description: Успешный ответ со списком групп
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/GroupListItem'
              examples:
                groups_list:
                  summary: Список групп
                  value:
                    success: true
                    data:
                      items:
                        - id: 1
                          name: IT Department
                          comment: Разработка и поддержка IT систем
                          hierarchyPathString: IT Department
                          userCount: 25
                          type: 2
                          image: https://s3.reezonly.com/groups/it-dept.jpg
                          created_at: 1692979543
                          updated_at: 1692979543
                        - id: 2
                          name: Development Team
                          comment: Frontend и backend разработка
                          hierarchyPathString: IT Department / Development Team
                          userCount: 15
                          type: 2
                          parent_id: 1
                          image: null
                          created_at: 1692983410
                          updated_at: 1692983410
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/view:
    get:
      tags:
        - Groups.Structure
      operationId: getGroup
      summary: Получить детальную информацию о группе
      description: |
        Возвращает полную информацию о группе.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            example: 1
          description: ID группы
      responses:
        '200':
          description: Детальная информация о группе
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          item:
                            $ref: '#/components/schemas/GroupDetail'
              examples:
                group_detail:
                  summary: Детальная информация о группе
                  value:
                    success: true
                    data:
                      item:
                        id: 1
                        name: IT Department
                        comment: Разработка и поддержка IT систем
                        hierarchyPathString: IT Department
                        userCount: 25
                        type: 2
                        image: https://s3.reezonly.com/groups/it-dept.jpg
                        parent_id: null
                        created_at: 1692979543
                        updated_at: 1692979543
                        users:
                          - id: 101
                            username: john.doe
                            email: john.doe@company.com
                            role: admin
                            created_at: '2023-08-25T14:20:00Z'
                          - id: 102
                            username: jane.smith
                            email: jane.smith@company.com
                            role: editor
                            created_at: '2023-08-25T14:25:00Z'
                        children:
                          - id: 2
                            name: Development Team
                            userCount: 15
                            hierarchyPathString: IT Department / Development Team
                      rules: []
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/create:
    post:
      tags:
        - Groups.Structure
      operationId: createGroup
      summary: Создать новую группу
      description: |
        Создает новую группу пользователей с поддержкой иерархии.
        Автоматически валидирует структуру иерархии, предотвращая циклические зависимости.
        Поддерживает загрузку изображения группы и опциональное добавление пользователей.

        **Бизнес-логика:**
        - Проверка уникальности названия в рамках родительской группы
        - Валидация иерархии (предотвращение циклов)
        - Автоматическое построение иерархического пути
        - Загрузка изображения в S3 хранилище
        - Логирование действия в ActionLog
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/GroupForm'
            examples:
              create_root:
                summary: Создание корневой группы
                value:
                  name: Support
              create_child:
                summary: Создание подгруппы
                value:
                  name: Support / L1
                  parent_id: 20
      responses:
        '200':
          description: Группа успешно создана
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          group_id:
                            type: integer
                            example: 25
              examples:
                created:
                  summary: Создана подгруппа
                  value:
                    success: true
                    data:
                      group_id: 25
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/update:
    put:
      tags:
        - Groups.Structure
      operationId: updateGroup
      summary: Обновить информацию о группе
      description: |
        Обновляет базовую информацию о группе: название, описание, родительскую группу.
        При изменении parent_id автоматически перестраивается иерархический путь
        для всех дочерних групп.

        **Важно:** Изменение родительской группы затрагивает всю ветку дочерних групп.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            example: 12
          description: ID группы для обновления
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/GroupForm'
            examples:
              rename:
                summary: Переименование группы
                value:
                  name: Sales / Enterprise
              move:
                summary: Перенос в другую родительскую группу
                value:
                  name: Sales
                  parent_id: 5
      responses:
        '200':
          description: Группа успешно обновлена
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          group_id:
                            type: integer
                            example: 10
              examples:
                updated:
                  summary: Переименование и перенос
                  value:
                    success: true
                    data:
                      group_id: 10
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/delete:
    delete:
      tags:
        - Groups.Structure
      operationId: deleteGroup
      summary: Удалить группу
      description: |
        Удаляет группу и все связанные данные:
        - Связи пользователей с группой
        - Правила доступа группы
        - Логирование действия

        **Важно:** Нельзя удалить группу, у которой есть дочерние группы.
        Сначала нужно удалить или переместить все дочерние группы.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID группы для удаления
      responses:
        '200':
          description: Группа успешно удалена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  value:
                    success: true
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/multiple-delete:
    delete:
      tags:
        - Groups.Structure
      operationId: deleteGroupsBulk
      summary: Массовое удаление групп
      description: |
        Удаляет несколько групп за один запрос. Каждая группа проверяется
        на отсутствие дочерних групп перед удалением.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - groupIds
              properties:
                groupIds:
                  type: array
                  items:
                    type: integer
                    minimum: 1
                  maxItems: 50
                  description: Массив ID групп для удаления (максимум 50)
            examples:
              delete_batches:
                summary: Удаление трёх групп
                value:
                  groupIds:
                    - 10
                    - 11
                    - 12
      responses:
        '200':
          description: Результат массового удаления
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Удаление без ошибок
                  value:
                    success: true
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /dictionary/user/groups:
    get:
      tags:
        - Groups.Structure
      operationId: listDictionaryGroups
      summary: Получить список групп для справочника
      description: Возвращает плоский список групп; иерархия собирается на клиенте при необходимости.
      parameters:
        - name: showDefault
          in: query
          schema:
            type: integer
            enum:
              - 0
              - 1
            default: 0
          description: Показать системные группы (гостевые/авторизованные)
      responses:
        '200':
          description: Список групп
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Group'
              examples:
                list:
                  summary: Плоский список групп
                  value:
                    success: true
                    items:
                      - id: 1
                        name: Root
                      - id: 2
                        name: Sales
                        parent_id: 1
                      - id: 3
                        name: Marketing
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/user-add:
    post:
      tags:
        - Groups.Members
      operationId: assignGroupUser
      summary: Добавить пользователей в группы
      description: |
        Добавляет пользователей в одну или несколько групп.
        Поддерживает пакетную обработку до 100 пользователей.
        Проверяет дубликаты и автоматически пропускает уже добавленных пользователей.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UsersGroupsFrom'
      responses:
        '200':
          description: Пользователи успешно добавлены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/user-delete:
    post:
      tags:
        - Groups.Members
      operationId: deleteGroupUser
      summary: Удалить пользователей из групп
      description: |
        Удаляет пользователей из указанных групп.
        Автоматически обрабатывает ситуации, когда пользователя нет в группе.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UsersGroupsFrom'
      responses:
        '200':
          description: Пользователи успешно удалены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/export:
    post:
      tags:
        - Groups.Structure
      operationId: createGroupExport
      summary: Запустить экспорт структуры групп
      description: |
        Создаёт задачу экспорта групп по указанным фильтрам. Возвращает идентификатор экспорта и ссылку для скачивания после формирования.

        **Назначение:** выгрузка дерева групп для сверки с внешней HR/CRM и последующего импорта/миграции.

        **Пример Use case:** HR переносит сотрудников между группами, обновляет курсы через `assign-courses`, а затем скачивает актуальный экспорт структуры, чтобы сверить дерево отделов с HRM.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              description: Фильтры экспорта (аналог фильтров списка групп).
            examples:
              export_xlsx:
                summary: Экспорт в XLSX без пользователей
                value:
                  format: xlsx
                  include_users: false
              export_csv_with_users:
                summary: Экспорт в CSV с пользователями
                value:
                  format: csv
                  include_users: true
      responses:
        '200':
          description: Экспорт поставлен в очередь
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          export_id:
                            type: integer
                            example: 102
                          download_url:
                            type: string
                            format: uri
                            example: https://space.example.com/export/102.xlsx
              examples:
                started:
                  summary: Задача экспорта создана
                  value:
                    success: true
                    data:
                      export_id: 102
                      download_url: https://space.example.com/export/102.xlsx
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/export-download:
    get:
      tags:
        - Groups.Structure
      operationId: createGroupExportDownload
      summary: Скачать сформированный экспорт групп
      description: |
        Возвращает файл экспорта (XLSX/CSV) по идентификатору задачи экспорта.
        Используется после получения уведомления о готовности экспорта или поллинга статуса.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
          description: ID задания экспорта
      responses:
        '200':
          description: Экспорт готов
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
              examples:
                export_file:
                  summary: Готовый XLSX экспорт
                  value: UEsDBBQACAgI...
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /group/group/assign-courses:
    post:
      tags:
        - Groups.Members
      operationId: assignGroupCourses
      summary: Назначить курсы всем участникам группы
      description: |
        Назначает указанные курсы всем текущим участникам группы.
        Операция выполняется асинхронно через очередь для больших групп.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/GroupCourseForm'
      responses:
        '200':
          description: Курсы успешно назначены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                queued:
                  summary: Задача поставлена в очередь
                  value:
                    success: true
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/template/index:
    get:
      operationId: listCertificateTemplates
      tags:
        - Certificates.Templates
      summary: Получить список шаблонов сертификатов
      description: Возвращает все доступные шаблоны для генерации сертификатов
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - name: active_only
          in: query
          required: false
          schema:
            type: boolean
            default: true
          description: Показать только активные шаблоны
      responses:
        '200':
          description: List of certificate templates
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/CertificateTemplate'
              examples:
                templates_page:
                  summary: Список активных шаблонов
                  value:
                    success: true
                    data:
                      pagination:
                        total: 2
                        page: 1
                        per_page: 20
                      items:
                        - id: 1
                          name: Default Blue
                          description: Базовый синий шаблон
                          preview_url: https://cdn.space/templates/1/preview.png
                          active: true
                          created_at: 1727772000
                          updated_at: 1730419200
                        - id: 2
                          name: Gold Award
                          description: Золотой шаблон для VIP выпусков
                          preview_url: https://cdn.space/templates/2/preview.png
                          active: true
                          created_at: 1728115200
                          updated_at: 1730534400
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/template/view:
    get:
      operationId: getCertificateTemplate
      tags:
        - Certificates.Templates
      summary: Получить детальную информацию о шаблоне сертификата
      description: Возвращает полную информацию о шаблоне включая переменные и предпросмотр
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Certificate template details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 2
                          name:
                            type: string
                            example: Gold Award
                          description:
                            type: string
                            example: Golden template for VIPs
                          template_html:
                            type: string
                            example: <html><body>...</body></html>
                          variables:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                  example: student_name
                                type:
                                  type: string
                                  example: string
                                description:
                                  type: string
                                  example: Full name of the student
                                required:
                                  type: boolean
                                  example: true
                          preview_url:
                            type: string
                            example: https://cdn.space/templates/2/preview.png
                          active:
                            type: boolean
                            example: true
              examples:
                template_detail:
                  summary: Детальный шаблон
                  value:
                    success: true
                    data:
                      id: 2
                      name: Gold Award
                      description: Золотой шаблон для VIP выпусков
                      template_html: <html>...шаблон...</html>
                      variables:
                        - name: username
                          type: string
                          description: Имя студента
                          required: true
                        - name: course_title
                          type: string
                          required: true
                      preview_url: https://cdn.space/templates/2/preview.png
                      active: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/certificate/index:
    get:
      operationId: listCertificates
      tags:
        - Certificates.Issued
      summary: Получить список выданных сертификатов
      description: Возвращает список выданных сертификатов с фильтрацией
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Sort'
        - name: search
          in: query
          required: false
          schema:
            type: string
          description: Поиск по сертификатам
        - name: course_id
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
          description: Фильтр по ID курса
        - name: user_id
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
          description: Фильтр по ID пользователя
      responses:
        '200':
          description: List of issued certificates
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/Certificate'
              examples:
                list:
                  summary: Список сертификатов с фильтрами
                  value:
                    success: true
                    data:
                      pagination:
                        total: 2
                        page: 1
                        per_page: 20
                      items:
                        - id: 45
                          number: CERT-2024-001
                          created_at: 1727772000
                          course:
                            id: 456
                            alias: onboarding-2024
                            title: Онбординг
                            type_id: 1
                            picture_thumbnail: https://cdn.space/courses/456/thumb.png
                          user:
                            id: 123
                            username: Иван Иванов
                            email: ivan@example.com
                          file: https://s3.space/certificates/2024/cert-45.pdf
                        - id: 46
                          number: CERT-2024-002
                          created_at: 1728115200
                          course:
                            id: 480
                            alias: sales-master-2024
                            title: Продажи B2B
                            type_id: 2
                            picture_thumbnail: https://cdn.space/courses/480/thumb.png
                          user:
                            id: 140
                            username: Мария Петрова
                            email: maria@example.com
                          file: https://s3.space/certificates/2024/cert-46.pdf
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/certificate/view:
    get:
      operationId: getCertificate
      tags:
        - Certificates.Issued
      summary: Получить информацию о выданном сертификате
      description: Возвращает детальную информацию о конкретном выданном сертификате
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Certificate details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Certificate'
              examples:
                detail:
                  summary: Детальный сертификат
                  value:
                    success: true
                    data:
                      id: 45
                      number: CERT-2024-001
                      created_at: 1727772000
                      user:
                        id: 123
                        username: Иван Иванов
                        email: ivan@example.com
                      course:
                        id: 456
                        alias: onboarding-2024
                        title: Онбординг
                        type_id: 1
                        picture_thumbnail: https://cdn.space/courses/456/thumb.png
                      file: https://s3.space/certificates/2024/cert-45.pdf
                      fields:
                        - key: student_name
                          value: Иван Иванов
                        - key: course_title
                          value: Онбординг
                      template:
                        id: 2
                        name: Gold Award
                        hide_for_student: false
                        file: https://s3.space/templates/2/template.pdf
                        type:
                          id: 1
                          name: Course completion
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/certificate/create:
    post:
      operationId: createCertificate
      tags:
        - Certificates.Issued
      summary: Выдать сертификат
      description: Выдает новый сертификат пользователю за прохождение курса
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - course_id
                - template_id
              properties:
                user_id:
                  type: integer
                  minimum: 1
                  description: ID пользователя
                  example: 123
                course_id:
                  type: integer
                  minimum: 1
                  description: ID курса
                  example: 456
                template_id:
                  type: integer
                  minimum: 1
                  description: ID шаблона сертификата
                  example: 2
                issue_date:
                  type: string
                  format: date
                  description: Дата выдачи (по умолчанию текущая)
                  example: '2024-01-15'
                expires_at:
                  type: string
                  format: date
                  description: Дата истечения (необязательно)
                  example: '2025-01-15'
                custom_data:
                  type: object
                  description: Дополнительные данные для шаблона
            examples:
              issue_single:
                summary: Выдача сертификата студенту
                value:
                  user_id: 123
                  course_id: 456
                  template_id: 2
                  issue_date: '2024-01-15'
                  expires_at: '2025-01-15'
                  custom_data:
                    username: Иван Иванов
                    course_title: Онбординг
      responses:
        '200':
          description: Certificate issued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                issued:
                  summary: Сертификат выдан
                  value:
                    success: true
                    message: Certificate created
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/certificate/download:
    get:
      operationId: downloadCertificate
      tags:
        - Certificates.Issued
      summary: Скачать PDF сертификата
      description: Возвращает PDF файл сертификата для скачивания
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: PDF certificate file
          content:
            application/pdf:
              schema:
                type: string
                format: binary
              examples:
                pdf_file:
                  summary: PDF сертификата
                  value: UEsDBBQACAgI...
        '404':
          description: Certificate not found
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/download-zip:
    post:
      operationId: downloadCertificatesZip
      tags:
        - Certificates.Issued
      summary: Сформировать ZIP с сертификатами
      description: |
        Запускает генерацию ZIP-архива сертификатов по фильтрам (search, course_id, user_id, пагинация, сортировка). Одновременно может быть только одна активная задача на ключ.

        **Назначение:** массовая выгрузка сертификатов для передачи внешним системам или печати.

        **Пример Use case:** администратор выбирает курс и диапазон пользователей, запускает экспорт и получает ссылку на архив.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                search:
                  type: string
                  example: ivan
                course_id:
                  type: integer
                  minimum: 1
                  example: 456
                user_id:
                  type: integer
                  minimum: 1
                  example: 123
                page:
                  type: integer
                  minimum: 1
                  default: 1
                  example: 1
                per-page:
                  type: integer
                  minimum: 1
                  maximum: 500
                  default: 50
                  example: 50
                sort:
                  type: string
                  example: '-created_at'
            examples:
              download_zip_request:
                summary: Экспорт сертификатов по курсу
                value:
                  course_id: 456
                  page: 1
                  per-page: 100
                  sort: '-issued_at'
      responses:
        '200':
          description: Задача запущена
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: Commit job queued
                      data:
                        type: object
                        properties:
                          filePath:
                            type: string
                            format: uri
                            example: https://space.example.com/uploads/certificates/zip/abc.zip
              examples:
                download_zip_queued:
                  summary: Задача на экспорт создана
                  value:
                    success: true
                    message: Commit job queued
                    data:
                      filePath: https://space.example.com/uploads/certificates/zip/certificates-2025-02-11.zip
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/course/index:
    get:
      operationId: listCertificateCourses
      tags:
        - Certificates.Lookups
      summary: Список курсов для выдачи сертификатов
      description: Возвращает курсы (id, title, type) для выбора `course_id` при выдаче сертификатов.
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Sort'
        - name: title
          in: query
          required: false
          schema:
            type: string
          description: Поиск по названию курса
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  example: 12
                                title:
                                  type: string
                                  example: Онбординг
                                type:
                                  type: string
                                  example: course
              examples:
                courses_page:
                  summary: Курсы для выбора сертификата
                  value:
                    success: true
                    data:
                      pagination:
                        total: 2
                        page: 1
                        per_page: 20
                      items:
                        - id: 12
                          title: Онбординг
                          type: course
                        - id: 18
                          title: Менторская программа
                          type: program
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/user/index:
    get:
      operationId: listCertificateUsers
      tags:
        - Certificates.Lookups
      summary: Список пользователей для выдачи сертификатов
      description: Возвращает пользователей (id, username, email) для выбора `user_id` при выдаче сертификатов.
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - name: search
          in: query
          schema:
            type: string
          description: Поиск по имени/email
        - name: courseIds
          in: query
          schema:
            type: array
            items:
              type: integer
          description: Массив ID продуктов/курсов
        - name: groupIds
          in: query
          schema:
            type: array
            items:
              type: integer
          description: Массив ID групп
        - name: inAllGroups
          in: query
          schema:
            type: boolean
          description: Требовать принадлежность ко всем указанным группам
        - name: progressFrom
          in: query
          schema:
            type: integer
          description: Минимальный прогресс
        - name: progressTo
          in: query
          schema:
            type: integer
          description: Максимальный прогресс
        - name: documentExists
          in: query
          schema:
            type: integer
            enum:
              - 0
              - 1
          description: Фильтр по наличию документа
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  example: 101
                                username:
                                  type: string
                                  example: Иван Иванов
                                email:
                                  type: string
                                  example: ivan@example.com
              examples:
                users_page:
                  summary: Пользователи для выдачи
                  value:
                    success: true
                    data:
                      pagination:
                        total: 2
                        page: 1
                        per_page: 20
                      items:
                        - id: 101
                          username: Иван Иванов
                          email: ivan@example.com
                        - id: 102
                          username: Мария Петрова
                          email: maria@example.com
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/type/index:
    get:
      operationId: listCertificateTypes
      tags:
        - Certificates.Lookups
      summary: Справочник типов сертификатов
      description: Возвращает список типов сертификатов для подстановки в запросах выдачи.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  example: 1
                                name:
                                  type: string
                                  example: Course completion
                                description:
                                  type:
                                    - string
                                    - 'null'
                                  example: Выдаётся за прохождение курса
              examples:
                certificate_types:
                  summary: Доступные типы сертификатов
                  value:
                    success: true
                    data:
                      items:
                        - id: 1
                          name: Course completion
                          description: Выдаётся за прохождение курса
                        - id: 2
                          name: Exam
                          description: Выдаётся за сдачу экзамена
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/variable/index:
    get:
      operationId: listCertificateVariables
      tags:
        - Certificates.Lookups
      summary: Список переменных сертификатов
      description: Возвращает доступные переменные для шаблонов сертификатов (ключ, имя, обязательность).
      parameters:
        - name: list_id
          in: query
          schema:
            type: integer
          description: ID списка переменных
        - name: name
          in: query
          schema:
            type: string
          description: Фильтр по имени переменной
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  example: 5
                                key:
                                  type: string
                                  example: username
                                name:
                                  type: string
                                  example: Имя пользователя
                                description:
                                  type:
                                    - string
                                    - 'null'
                                  example: Отображается на сертификате
                                required:
                                  type: boolean
                                  example: true
              examples:
                certificate_variables:
                  summary: Переменные для шаблонов
                  value:
                    success: true
                    data:
                      items:
                        - id: 5
                          key: username
                          name: Имя пользователя
                          description: Отображается на сертификате
                          required: true
                        - id: 6
                          key: course_title
                          name: Название курса
                          required: true
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /certificate/variable-list/index:
    get:
      operationId: listCertificateVariableValues
      tags:
        - Certificates.Lookups
      summary: Наборы переменных сертификатов
      description: Возвращает значения переменных (variable_id, key, value) для подстановки в шаблоны.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                variable_id:
                                  type: integer
                                  example: 5
                                key:
                                  type: string
                                  example: username
                                value:
                                  type: string
                                  example: Иван Иванов
              examples:
                certificate_variable_values:
                  summary: Значения переменных
                  value:
                    success: true
                    data:
                      items:
                        - variable_id: 5
                          key: username
                          value: Иван Иванов
                        - variable_id: 6
                          key: course_title
                          value: Онбординг
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /course/course/index:
    get:
      operationId: listCourses
      tags:
        - Courses
      summary: Получить каталог курсов
      description: Возвращает список доступных курсов с базовой информацией (только чтение)
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - name: title
          in: query
          schema:
            type: string
          description: Поиск по названию курса
        - name: type
          in: query
          schema:
            type: integer
          description: Тип курса (см. Course::TYPE_*)
        - name: enabled
          in: query
          schema:
            type: string
          description: Фильтр по признаку доступности
        - name: sort
          in: query
          schema:
            type: string
          description: Поле сортировки
        - name: status
          in: query
          schema:
            type: string
          description: Статус курса
        - name: type_id
          in: query
          schema:
            type: integer
          description: ID типа (product id)
      responses:
        '200':
          description: List of courses
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          pagination:
                            $ref: '#/components/schemas/PaginationMeta'
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  example: 101
                                title:
                                  type: string
                                  example: Онбординг
                                description:
                                  type: string
                                  example: Базовый курс для новых сотрудников
                                status:
                                  type: string
                                  example: active
                                price:
                                  type: number
                                  example: 1990
                                duration:
                                  type: string
                                  example: 6h
                                category:
                                  type: object
                                  properties:
                                    id:
                                      type: integer
                                      example: 5
                                    name:
                                      type: string
                                      example: Корпоративное обучение
                                thumbnail_url:
                                  type: string
                                  example: https://cdn.space/courses/101.png
                                lms_id:
                                  type: integer
                                  description: ID курса в LMS системе
                                  example: 501
                                student_count:
                                  type: integer
                                  example: 240
              examples:
                courses_page:
                  summary: Список курсов с фильтром по статусу
                  value:
                    success: true
                    data:
                      pagination:
                        total: 2
                        page: 1
                        per_page: 20
                      items:
                        - id: 101
                          title: Онбординг
                          description: Базовый курс для новых сотрудников
                          status: active
                          price: 0
                          duration: 2h
                          category:
                            id: 5
                            name: Корпоративное обучение
                          thumbnail_url: https://cdn.space/courses/101.png
                          lms_id: 501
                          student_count: 240
                        - id: 102
                          title: Продажи B2B
                          description: Практикум по продажам
                          status: active
                          price: 1990
                          duration: 6h
                          category:
                            id: 6
                            name: Продажи
                          thumbnail_url: https://cdn.space/courses/102.png
                          lms_id: 502
                          student_count: 120
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /course/course/view:
    get:
      operationId: getCourse
      tags:
        - Courses
      summary: Получить детальную информацию о курсе
      description: Возвращает полную информацию о курсе включая программу обучения (только чтение)
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Course details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          item:
                            $ref: '#/components/schemas/CourseDetail'
              examples:
                course_detail:
                  summary: Детальный курс с программой
                  value:
                    success: true
                    data:
                      item:
                        id: 101
                        title: Онбординг
                        description: Базовый курс для новых сотрудников
                        status: active
                        price: 0
                        duration: 2h
                        level: beginner
                        category:
                          id: 5
                          name: Корпоративное обучение
                        instructor:
                          id: 77
                          name: Анна Смирнова
                          avatar_url: https://cdn.space/instructors/77.png
                        thumbnail_url: https://cdn.space/courses/101.png
                        lms_id: 501
                        syllabus:
                          - id: 1
                            title: Введение
                            description: Как работать в системе
                            duration: 10m
                            order: 1
                        requirements:
                          - Корпоративная почта
                        outcomes:
                          - Понимание процессов компании
                        student_count: 240
                        rating: 4.8
                        reviews_count: 56
                        created_at: '2024-01-10T09:00:00Z'
                        updated_at: '2024-11-02T11:00:00Z'
        '404':
          description: Course not found
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - BearerToken: []
  /dictionary/dictionary/page-types:
    get:
      operationId: listPageTypes
      tags:
        - Pages
      summary: Получить список типов страниц
      description: |
        Справочник типов страниц сайта и продуктов (read-only): landing, blog, help, legal и другие.

        **Назначение:** дать фронтам и внешним CMS нормализованные типы для фильтров и группировки страниц/лендингов.

        **Ключевые особенности:** стабильные коды типов, совместимость с `/dictionary/dictionary/pages`, можно кешировать на клиенте.

        **Пример Use case:** SPA-витрина запрашивает типы, строит фильтры и подсветку меню по категориям страниц.
      parameters:
        - name: type
          in: query
          required: false
          schema:
            type: string
          description: Фильтр по типу страницы
      responses:
        '200':
          description: Page types list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/PageType'
                            example:
                              - id: 3
                                name: landing
              examples:
                page_types:
                  summary: Доступные типы страниц
                  value:
                    success: true
                    data:
                      items:
                        - id: 3
                          name: landing
                        - id: 4
                          name: blog
        '400':
          $ref: '#/components/responses/BadRequest'
      security:
        - BearerToken: []
  /dictionary/dictionary/pages:
    get:
      operationId: listPages
      tags:
        - Pages
      summary: Получить справочник страниц
      description: |
        Доступные страницы сайта (лендинги, продуктовые страницы) с базовыми метаданными (read-only): `title`, `alias`, `type`, `enabled`, SEO-атрибуты.

        **Назначение:** раскрыть структуру публичных и закрытых страниц, чтобы внешние CMS могли собирать меню и лендинги без доступа в админку.

        **Ключевые особенности:** фильтрация по типу (используйте `/dictionary/dictionary/page-types`), статус `enabled`, поля `alias` и `category` для навигации.

        **Пример Use case:** внешняя система заимствует SPA-меню, вызывает `/dictionary/dictionary/pages`, сортирует по типу и обновляет ссылки на новом сайте без внутреннего CMS.
      responses:
        '200':
          description: Pages list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/DictionaryPage'
                            example:
                              - id: 12
                                alias: product-page-42
                                title: Курс "Data Science"
                                description: Лендинг продукта Data Science
                                enabled: true
                                type: product-page
              examples:
                pages_dict:
                  summary: Справочник страниц
                  value:
                    success: true
                    data:
                      items:
                        - id: 12
                          alias: product-page-42
                          title: Курс "Data Science"
                          description: Лендинг продукта Data Science
                          enabled: true
                          type: product-page
                        - id: 18
                          alias: help-center
                          title: Центр помощи
                          description: Справочные статьи
                          enabled: true
                          type: help
        '400':
          $ref: '#/components/responses/BadRequest'
      security:
        - BearerToken: []
  /integration/report/consolidated:
    post:
      operationId: createIntegrationReport
      tags:
        - Integration Reports
      summary: Сводный отчёт (JSON)
      description: |
        JSON-эквивалент XLSX «Сводный» отчёта с фильтрами по продуктам, группам, прогрессу и полям профиля.

        **Назначение:** отдать тот же набор колонок, что в XLSX «Сводный», но в JSON для BI/дашбордов без генерации файлов.

        **Пример Use case:** BI-интеграция запрашивает данные по конкретным продуктам и отделам, строит графики прогресса и статусов оплат без скачивания XLSX.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                product:
                  type: array
                  items:
                    type: integer
                  example:
                    - 59
                    - 62
                group:
                  type: array
                  items:
                    type: integer
                  example:
                    - 14
                user_ids:
                  type: array
                  items:
                    type: integer
                  example:
                    - 215
                    - 216
                progress_from:
                  type: integer
                  minimum: 0
                  maximum: 100
                  default: 0
                  example: 50
                progress_to:
                  type: integer
                  minimum: 0
                  maximum: 100
                  default: 100
                  example: 85
                fields:
                  type: object
                  additionalProperties:
                    type: array
                    items:
                      type: string
                  description: Фильтры по полям профиля (username, email, phone, department, position)
                  example:
                    email:
                      - '@example.com'
                page:
                  type: integer
                  minimum: 1
                  default: 1
                  example: 1
                per-page:
                  type: integer
                  minimum: 1
                  maximum: 1000
                  default: 200
                  example: 200
                sort:
                  type: string
                  enum:
                    - '-date_added'
                    - date_added
                    - '-progress'
                    - progress
                  default: '-date_added'
                  example: '-date_added'
            examples:
              consolidated_request:
                summary: Фильтр по продуктам и прогрессу
                value:
                  product:
                    - 59
                    - 62
                  group:
                    - 14
                  progress_from: 50
                  progress_to: 85
                  page: 1
                  per-page: 200
                  sort: '-date_added'
      responses:
        '200':
          description: Отчёт сформирован
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          filters:
                            type: object
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                product:
                                  type: object
                                  properties:
                                    id:
                                      type: integer
                                      example: 59
                                    title:
                                      type: string
                                      example: Цифровые коммуникации
                                status:
                                  type: object
                                  properties:
                                    code:
                                      type: integer
                                      example: 4
                                    name:
                                      type: string
                                      example: Оплачен
                                amount:
                                  type: number
                                  example: 60000
                                date_added_at:
                                  $ref: '#/components/schemas/DateValue'
                                last_activity_at:
                                  $ref: '#/components/schemas/DateValue'
                                registered_at:
                                  $ref: '#/components/schemas/DateValue'
                                progress_percent:
                                  type: integer
                                  minimum: 0
                                  maximum: 100
                                  example: 72
                                user:
                                  type: object
                                  properties:
                                    id:
                                      type: integer
                                      example: 215
                                    name:
                                      type: string
                                      example: Георгий
                                    email:
                                      type: string
                                      format: email
                                      example: user@example.com
                                    phone:
                                      type: string
                                      example: '+79999999952'
                                    department:
                                      type: string
                                      example: Отдел разработки
                                    position:
                                      type: string
                                      example: Директор по продукту
                          pagination:
                            type: object
                            properties:
                              page:
                                type: integer
                                example: 1
                              per_page:
                                type: integer
                                example: 200
                              total:
                                type: integer
                                example: 8
                              total_pages:
                                type: integer
                                example: 1
              examples:
                sample:
                  summary: Пример успешного ответа
                  value:
                    success: true
                    data:
                      filters:
                        product:
                          - 59
                          - 62
                        progress_from: 50
                        progress_to: 85
                        fields:
                          email:
                            - ya.ru
                      items:
                        - product:
                            id: 59
                            title: Цифровые коммуникации
                          status:
                            code: 4
                            name: Оплачен
                          amount: 60000
                          date_added_at:
                            unix: 1730399460
                            iso: '2024-10-31T13:11:00+03:00'
                          last_activity_at:
                            unix: null
                            iso: null
                          registered_at:
                            unix: 1698747060
                            iso: '2023-10-31T13:11:00+03:00'
                          progress_percent: 72
                          user:
                            id: 215
                            name: Георгий
                            email: poooga@ya.ru
                            phone: '+79999999952'
                            department: Отдел разработки
                            position: Директор по продукту
                      pagination:
                        page: 1
                        per_page: 200
                        total: 8
                        total_pages: 1
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - BearerToken: []
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    BearerToken:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Bearer token authentication (JWT)
  schemas:
    UserListItem:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: john_doe
        email:
          type: string
          example: user@example.com
        department:
          type:
            - string
            - 'null'
          example: Marketing
        position:
          type:
            - string
            - 'null'
          example: Manager
        photo:
          type:
            - string
            - 'null'
          example: https://example.com/photo.jpg
        status:
          type: integer
          description: 0=New, 10=Active, 20=Blocked, 30=Unconfirmed
          example: 10
        created_at:
          type: integer
          example: 1699459200
        updated_at:
          type: integer
          example: 1699459200
        role:
          type: string
          example: admin
        educationAccess:
          type: boolean
          example: true
        courseCount:
          type: integer
          example: 5
        payment_sum:
          type: number
          example: 2999.99
        groups:
          type: array
          items:
            $ref: '#/components/schemas/Group'
    UserDetail:
      allOf:
        - $ref: '#/components/schemas/UserListItem'
        - type: object
          properties:
            phone:
              type:
                - string
                - 'null'
              example: '+79991234567'
            waitRequest:
              type: array
              items:
                type: object
            certificates:
              type: array
              items:
                $ref: '#/components/schemas/Certificate'
            courses:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  title:
                    type: string
                    example: example
                  status:
                    type: integer
                    example: 10
                  progress:
                    type: number
                    example: 75.5
                  amount:
                    type: number
                    example: 2999.99
                  group:
                    type:
                      - string
                      - 'null'
                    example: Group 1
            userFields:
              type: array
              items:
                $ref: '#/components/schemas/UserFieldDefinition'
    UserFieldDefinition:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          description: System name (key)
          example: John Doe
        title:
          type: string
          description: Display name
          example: Advanced Python
        type:
          type: integer
          description: Field type code
          example: 1
    UserCreateForm:
      type: object
      required:
        - username
        - email
        - password
      properties:
        username:
          type: string
          description: Уникальное имя пользователя
          example: john_doe
        email:
          type: string
          format: email
          description: Электронная почта (должна быть уникальной)
          example: user@example.com
        password:
          type: string
          description: Пароль пользователя
          example: example
        role:
          type: string
          description: Роль пользователя (admin, user и т.д.)
          example: admin
        department:
          type: string
          description: Отдел или подразделение
          example: Marketing
        position:
          type: string
          description: Должность пользователя
          example: Manager
    UserUpdateForm:
      type: object
      properties:
        username:
          type: string
          description: Уникальное имя пользователя
          example: john_doe
        email:
          type: string
          description: Электронная почта (должна быть уникальной)
          example: user@example.com
        department:
          type: string
          description: Отдел или подразделение
          example: Marketing
        position:
          type: string
          description: Должность пользователя
          example: Manager
        password:
          type: string
          description: Пароль пользователя (оставьте пустым, чтобы не менять)
          example: example
        role:
          type: string
          description: Роль пользователя (admin, user и т.д.)
          example: admin
    AddCourseForm:
      type: object
      required:
        - userIds
        - courses
      properties:
        userIds:
          type: array
          items:
            type: integer
        courses:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                example: 1
              learning_group_id:
                type: integer
                example: 1
    ImportReport:
      type: object
      properties:
        id:
          type: integer
          example: 456
        status:
          type: string
          enum:
            - pending
            - processing
            - completed
            - failed
          x-enumDescriptions:
            pending: Задача создана, ожидает запуска
            processing: Импорт выполняется
            completed: Импорт успешно завершён
            failed: Импорт завершился ошибкой
          example: completed
        total:
          type: integer
          description: Всего записей в импорте
          example: 100
        processed:
          type: integer
          description: Успешно обработано
          example: 98
        errors:
          type: integer
          description: Количество ошибок
          example: 2
        created_at:
          type: integer
          description: Unix timestamp создания отчёта импорта
          example: 1705316400
        updated_at:
          type: integer
          description: Unix timestamp последнего обновления отчёта
          example: 1705319400
    Group:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Отдел продаж
        description:
          type: string
          example: Сотрудники отдела продаж
        parent_id:
          oneOf:
            - type: integer
              minimum: 1
            - type: 'null'
          example: null
        members_count:
          type: integer
          example: 25
        hierarchy_level:
          type: integer
          example: 0
        created_at:
          type: integer
          description: Unix timestamp создания группы
          example: 1705316400
    GroupListItem:
      allOf:
        - $ref: '#/components/schemas/Group'
        - type: object
          properties:
            parent:
              type:
                - object
                - 'null'
              description: Информация о родительской группе
              properties:
                id:
                  type: integer
                  example: 1
                name:
                  type: string
                  example: IT Department
    GroupDetail:
      allOf:
        - $ref: '#/components/schemas/Group'
        - type: object
          properties:
            users:
              type: array
              description: Список пользователей группы
              items:
                allOf:
                  - $ref: '#/components/schemas/User'
                  - type: object
                    properties:
                      role_in_group:
                        type: string
                        description: Роль пользователя в группе
                        example: member
                      joined_at:
                        type: string
                        format: date-time
                        description: Дата добавления в группу
                        example: '2023-09-01T10:00:00Z'
            children:
              type: array
              description: Дочерние группы
              items:
                $ref: '#/components/schemas/GroupListItem'
            rules:
              type: array
              description: Правила доступа группы
              items:
                type: object
                properties:
                  type:
                    type: integer
                    example: 1
                  objectId:
                    type: integer
                    example: 42
                  objectType:
                    type: string
                    example: course
    CreateGroupRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 255
          description: Название группы (обязательное поле)
          example: Marketing Department
        comment:
          type: string
          maxLength: 512
          description: Описание группы (опционально)
          example: Отдел маркетинга и продвижения
        parent_id:
          type:
            - integer
            - 'null'
          minimum: 1
          description: |
            ID родительской группы:
            - `null` для корневой группы
            - ID существующей группы для дочерней
          example: null
        user_ids:
          type: array
          items:
            type: integer
            minimum: 1
          maxItems: 100
          description: Пользователи для добавления в группу
          example:
            - 101
            - 102
        image_upload:
          type: string
          format: binary
          description: Файл изображения группы (через multipart/form-data)
          example: https://example.com/photo.jpg
    GroupForm:
      allOf:
        - $ref: '#/components/schemas/CreateGroupRequest'
        - type: object
          properties:
            user_ids:
              type: array
              items:
                type: integer
                minimum: 1
              description: Пользователи для добавления
            image_upload:
              type: string
              format: binary
              description: Изображение группы (multipart/form-data)
              example: https://example.com/photo.jpg
    UsersGroupsFrom:
      type: object
      description: Пакетное добавление/удаление пользователей в группах через multipart/form-data
      required:
        - groupIds
        - userIds
      properties:
        groupIds:
          type: array
          items:
            type: integer
            minimum: 1
          minItems: 1
          maxItems: 10
          description: ID групп для операции
          example:
            - 2
            - 5
        userIds:
          type: array
          items:
            type: integer
            minimum: 1
          minItems: 1
          maxItems: 100
          description: ID пользователей для добавления/удаления
          example:
            - 101
            - 102
            - 103
        role:
          type: string
          enum:
            - superadmin
            - admin
            - editor
            - curator
            - student
          description: Роль пользователя в группе (опционально, используется при добавлении)
          example: editor
    GroupCourseForm:
      type: object
      description: Назначение курсов всем пользователям группы (multipart/form-data)
      required:
        - group_id
        - course_ids
      properties:
        group_id:
          type: integer
          minimum: 1
          description: ID группы, для которой назначаются курсы
          example: 12
        course_ids:
          type: array
          items:
            type: integer
            minimum: 1
          minItems: 1
          maxItems: 50
          description: Идентификаторы курсов для назначения
          example:
            - 501
            - 502
            - 503
    GroupMemberStats:
      type: object
      properties:
        count:
          type: integer
          description: Общее количество участников
          example: 25
        active_count:
          type: integer
          description: Количество активных участников
          example: 22
        inactive_count:
          type: integer
          description: Количество неактивных участников
          example: 3
        subgroup_users:
          type: integer
          description: Количество пользователей из дочерних групп (если include_subgroups=true)
          example: 15
        last_updated:
          type: string
          format: date-time
          description: Время последнего обновления статистики
          example: '2023-11-19T10:30:00Z'
    PageType:
      type: object
      properties:
        id:
          type: integer
          example: 3
        name:
          type: string
          example: product-page
    DictionaryPage:
      type: object
      properties:
        id:
          type: integer
          example: 12
        alias:
          type: string
          example: product-page-42
        title:
          type: string
          example: Курс "Data Science"
        description:
          type: string
          example: Лендинг продукта Data Science
        enabled:
          type: boolean
          example: true
        type:
          type: string
          description: Тип страницы (используйте справочник page-types)
          example: course-and-training-promo-page
    SuccessResponse:
      type: object
      description: Базовый успешный ответ (используется в Success, Created, UserList, GroupList, CertificateList)
      required:
        - success
      properties:
        success:
          type: boolean
          description: Флаг успешности операции
          example: true
        meta:
          $ref: '#/components/schemas/PaginationMeta'
          description: Пагинация (опционально, только для списков)
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        errors:
          type: object
          description: Ошибки валидации по полям
          example:
            email:
              - Email already taken.
            password:
              - Password minimum 6 characters.
    PaginationMeta:
      type: object
      properties:
        total:
          type: integer
          description: Общее количество элементов
          example: 150
        page:
          type: integer
          description: Текущая страница
          example: 1
        per_page:
          type: integer
          description: Элементов на странице
          example: 20
    User:
      type: object
      properties:
        id:
          type: integer
          example: 137
        email:
          type: string
          format: email
          example: user@example.com
        name:
          type: string
          example: Иван Иванов
        role:
          type: string
          enum:
            - admin
            - editor
            - curator
            - student
          x-enumDescriptions:
            admin: Администратор (полный доступ)
            editor: Контент-редактор
            curator: Куратор/методист
            student: Ученик/слушатель
          example: student
        status:
          type: string
          enum:
            - active
            - inactive
            - blocked
          x-enumDescriptions:
            active: Активный пользователь
            inactive: Неактивный (архив/черновик)
            blocked: Заблокирован (без доступа)
          example: active
        created_at:
          type: integer
          description: Unix timestamp создания пользователя
          example: 1705316400
        updated_at:
          type: integer
          description: Unix timestamp последнего обновления
          example: 1705316400
    Certificate:
      type: object
      description: Сертификат, выданный пользователю за прохождение курса
      properties:
        id:
          type: integer
          description: ID сертификата
          example: 45
        number:
          type:
            - string
            - 'null'
          description: Уникальный номер сертификата
          example: CERT-2024-001
        created_at:
          type: integer
          description: Дата выдачи сертификата (Unix timestamp)
          example: 1727772000
        course:
          $ref: '#/components/schemas/CertificateCourse'
        user:
          $ref: '#/components/schemas/CertificateUser'
        file:
          type:
            - string
            - 'null'
          description: URL скачивания PDF сертификата (S3)
          example: https://s3.space/certificates/2024/cert-45.pdf
        fields:
          type:
            - array
            - 'null'
          items:
            type: object
            properties:
              key:
                type: string
                example: username
              value:
                type: string
                example: Иван Иванов
          description: Значения переменных шаблона сертификата
        template:
          $ref: '#/components/schemas/CertificateTemplateInfo'
    CertificateCourse:
      type: object
      description: Информация о курсе (вложенный объект в Certificate)
      properties:
        id:
          type: integer
          example: 456
        alias:
          type: string
          description: Алиас/slug курса для URL
          example: onboarding-2024
        title:
          type: string
          description: Название курса
          example: Онбординг
        type_id:
          type: integer
          description: ID типа курса
          example: 1
        picture_thumbnail:
          type:
            - string
            - 'null'
          description: URL миниатюры курса
          example: https://cdn.space/courses/456/thumb.png
    CertificateUser:
      type: object
      description: Информация о пользователе (вложенный объект в Certificate)
      properties:
        id:
          type: integer
          example: 123
        username:
          type: string
          example: Иван Иванов
        email:
          type: string
          format: email
          example: ivan@example.com
    CertificateTemplateInfo:
      type: object
      description: Информация о шаблоне сертификата (вложенный объект в Certificate)
      properties:
        id:
          type: integer
          example: 2
        name:
          type: string
          description: Название шаблона
          example: Gold Award
        hide_for_student:
          type: boolean
          description: Скрыть для студента
          example: false
        file:
          type:
            - string
            - 'null'
          description: URL файла шаблона
          example: https://s3.space/templates/2/template.pdf
        type:
          type:
            - object
            - 'null'
          description: Тип сертификата
          properties:
            id:
              type: integer
              example: 1
            name:
              type: string
              example: Course completion
    CertificateTemplate:
      type: object
      properties:
        id:
          type: integer
          example: 3
        name:
          type: string
          description: Название шаблона сертификата
          example: Standard Completion
        description:
          type: string
          description: Краткое описание шаблона
          example: Базовый шаблон для завершения курса
        file_url:
          type: string
          format: uri
          description: Ссылка на файл шаблона (PDF/DOCX)
          example: https://cdn.space.com/cert-templates/standard.pdf
        preview_url:
          type: string
          format: uri
          description: Превью изображения шаблона
          example: https://cdn.space.com/cert-templates/standard.png
        created_at:
          type: integer
          example: 1733044800
        updated_at:
          type: integer
          example: 1734273000
    CertificateDetail:
      $ref: '#/components/schemas/Certificate'
    DateValue:
      type:
        - object
        - 'null'
      properties:
        unix:
          type:
            - integer
            - 'null'
          example: 1730399460
        iso:
          type:
            - string
            - 'null'
          example: '2024-10-31T13:11:00+03:00'
    ImportStatus:
      type: object
      properties:
        id:
          type: string
          example: import_123456
        status:
          type: string
          enum:
            - pending
            - processing
            - completed
            - failed
          x-enumDescriptions:
            pending: Задача создана, ожидает запуска
            processing: Импорт выполняется
            completed: Импорт успешно завершён
            failed: Импорт завершился ошибкой
          example: processing
        progress:
          type: object
          properties:
            total:
              type: integer
              example: 1000
            processed:
              type: integer
              example: 650
            errors:
              type: integer
              example: 5
        started_at:
          type: integer
          description: Unix timestamp начала импорта
          example: 1705316400
        estimated_completion:
          type: string
          format: date-time
          description: Ориентировочное время завершения (ISO 8601)
          example: '2024-01-15T11:00:00Z'
    Course:
      type: object
      properties:
        id:
          type: integer
          example: 101
        title:
          type: string
          example: Онбординг
        description:
          type: string
          example: Базовый курс для новых сотрудников
        status:
          type: string
          enum:
            - draft
            - active
            - archived
          example: active
        price:
          type: number
          format: float
          example: 0
        duration:
          type: string
          description: Продолжительность в удобном формате
          example: 2h
        level:
          type: string
          enum:
            - beginner
            - intermediate
            - advanced
          example: beginner
        category:
          type: object
          properties:
            id:
              type: integer
              example: 5
            name:
              type: string
              example: Корпоративное обучение
        instructor:
          type: object
          properties:
            id:
              type: integer
              example: 77
            name:
              type: string
              example: Анна Смирнова
            avatar_url:
              type: string
              format: uri
              example: https://cdn.space/instructors/77.png
        thumbnail_url:
          type: string
          format: uri
          example: https://cdn.space/courses/101.png
        lms_id:
          type: integer
          example: 501
    CourseDetail:
      allOf:
        - $ref: '#/components/schemas/Course'
        - type: object
          properties:
            syllabus:
              type: array
              description: Список модулей/уроков
              items:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  title:
                    type: string
                    example: Введение
                  description:
                    type: string
                    example: Как работать в системе
                  duration:
                    type: string
                    example: 10m
    FileUploadResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        file_id:
          type: string
          example: file_abc123
        filename:
          type: string
          example: users_import.xlsx
        size:
          type: integer
          example: 25600
        mime_type:
          type: string
          example: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
  parameters:
    Page:
      in: query
      name: page
      description: Номер страницы для пагинации
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1
    PerPage:
      in: query
      name: per_page
      description: Количество элементов на странице (максимум 100)
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 50
    Search:
      in: query
      name: search
      description: Поисковый запрос для фильтрации результатов
      required: false
      schema:
        type: string
        example: ivan
    Id:
      in: query
      name: id
      description: Идентификатор ресурса
      required: true
      schema:
        type: integer
        minimum: 1
        example: 42
    Sort:
      in: query
      name: sort
      description: Сортировка результатов (например, -created_at для обратной сортировки)
      required: false
      schema:
        type: string
        example: '-created_at'
    Ids:
      in: query
      name: ids[]
      description: Массив идентификаторов для массовых операций (максимум 100 элементов)
      required: true
      schema:
        type: array
        items:
          type: integer
          minimum: 1
        maxItems: 100
        example:
          - 12
          - 15
          - 20
  responses:
    Success:
      description: Успешное выполнение операции
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Operation completed successfully
    Created:
      description: Ресурс успешно создан
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Resource created successfully
    UserList:
      description: Список пользователей успешно получен
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      pagination:
                        $ref: '#/components/schemas/PaginationMeta'
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
    GroupList:
      description: Список групп успешно получен
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/Group'
    CertificateList:
      description: Список сертификатов успешно получен
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      pagination:
                        $ref: '#/components/schemas/PaginationMeta'
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/Certificate'
    BadRequest:
      description: Ошибка в запросе (неверные параметры)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              email:
                - Некорректный email
              page:
                - page must be >= 1
    Unauthorized:
      description: Ошибка аутентификации (отсутствует или неверный API ключ)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              api_key:
                - Неверный или отсутствующий X-API-Key
    Forbidden:
      description: Доступ запрещен (недостаточно прав)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              access:
                - Недостаточно прав для выполнения операции
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              id:
                - Ресурс не найден
    ValidationError:
      description: Ошибка валидации данных
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              password:
                - Password must be at least 6 characters
    UnprocessableEntity:
      description: Ошибка валидации данных (422)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              password:
                - Password must be at least 6 characters
    InternalError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              server:
                - Internal server error. Try again later
    TooManyRequests:
      description: Превышен лимит запросов
      headers:
        Retry-After:
          description: Через сколько секунд можно повторить запрос
          schema:
            type: integer
            example: 30
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              rate_limit:
                - Превышен лимит запросов. Повторите через 30 секунд
x-servers:
  - url: https://your-space-domain.com/api/v1
    description: Production
  - url: https://staging-space-domain.com/api/v1
    description: Staging
  - url: http://localhost:8080/api/v1
    description: Local
x-tagGroups:
  - name: Users
    title: User Management — 16 методов
    description: |-
      Раздел User Management предназначен для синхронизации пользователей между вашей CRM/ERP и платформой Space. Каждый пользователь имеет профиль с контактной информацией, роль доступа, статус и может быть участником групп и курсов.

      User представляет пользователя в системе Reezonly Space. Каждый пользователь имеет профиль с контактной информацией, роль доступа, статус и может быть участником групп и курсов.
    tags:
      - Users.Operations
      - Users.Courses
      - Users.Import
      - Users.Fields
  - name: Groups
    title: Groups — 12 методов
    description: |-
      Раздел Groups предназначен для управления иерархической структурой групп пользователей в системе Space. Группы могут иметь вложенность, что позволяет создавать сложные организационные структуры.

      Group представляет собой коллекцию пользователей с общей ролью или принадлежностью к отделу/проекту. Группы поддерживают иерархическую структуру с неограниченной вложенностью.
    tags:
      - Groups.Structure
      - Groups.Members
  - name: Certificates
    title: Certificates — 12 методов
    description: |-
      Раздел Certificates предназначен для управления PDF сертификатами, которые выдаются пользователям за прохождение курсов. Система поддерживает шаблоны сертификатов, массовую и индивидуальную выдачу, а также интеграцию с внешними системами верификации.

      Certificate представляет собой PDF документ, подтверждающий успешное завершение обучения. Каждый сертификат имеет уникальный номер, дату выдачи и может быть проверен через публичный интерфейс.
    tags:
      - Certificates.Templates
      - Certificates.Issued
      - Certificates.Lookups
  - name: Learning
    title: Learning — 4 метода (READ-ONLY)
    description: |-
      Раздел Learning предоставляет доступ к каталогу курсов и страниц контента в режиме чтения. Основной контент курсов хранится во внешней LMS системе, а Space выступает как витрина и система управления доступом.

      ⚠️ Важно: Эти методы доступны только для чтения. Изменение контента курсов и уроков выполняется через LMS, а не через этот API.
    tags:
      - Courses
      - Pages
  - name: Integration Reports
    title: Integration Reports — 1 метод
    description: Раздел Integration Reports предназначен для предоставления аналитических данных внешним системам. Этот модуль позволяет получать отчеты об интеграционной активности, результатах импорта и экспорта данных, а также ключевые метрики для мониторинга работы интеграций.
    tags:
      - Integration Reports
