# Common Responses for Reezonly Space API
components:
  responses:
    # Success responses
    Success:
      description: Успешное выполнение операции
      content:
        application/json:
          schema:
            allOf:
              - $ref: './schemas.yaml#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: "Operation completed successfully"

    Created:
      description: Ресурс успешно создан
      content:
        application/json:
          schema:
            allOf:
              - $ref: './schemas.yaml#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: "Resource created successfully"

    # Success responses with specific data
    UserList:
      description: Список пользователей успешно получен
      content:
        application/json:
          schema:
            allOf:
              - $ref: './schemas.yaml#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      pagination:
                        $ref: './schemas.yaml#/components/schemas/PaginationMeta'
                      items:
                        type: array
                        items:
                          $ref: './schemas.yaml#/components/schemas/User'

    GroupList:
      description: Список групп успешно получен
      content:
        application/json:
          schema:
            allOf:
              - $ref: './schemas.yaml#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: './schemas.yaml#/components/schemas/Group'

    CertificateList:
      description: Список сертификатов успешно получен
      content:
        application/json:
          schema:
            allOf:
              - $ref: './schemas.yaml#/components/schemas/SuccessResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      pagination:
                        $ref: './schemas.yaml#/components/schemas/PaginationMeta'
                      items:
                        type: array
                        items:
                          $ref: './schemas.yaml#/components/schemas/Certificate'

    # Error responses
    BadRequest:
      description: Ошибка в запросе (неверные параметры)
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              email:
                - "Некорректный email"
              page:
                - "page must be >= 1"

    Unauthorized:
      description: Ошибка аутентификации (отсутствует или неверный API ключ)
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              api_key:
                - "Неверный или отсутствующий X-API-Key"

    Forbidden:
      description: Доступ запрещен (недостаточно прав)
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              access:
                - "Недостаточно прав для выполнения операции"

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              id:
                - "Ресурс не найден"

    ValidationError:
      description: Ошибка валидации данных
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              field:
                - "Значение поля некорректно"

    UnprocessableEntity:
      description: Ошибка валидации данных (422)
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              field:
                - "Значение поля некорректно"

    ValidationPaginationInteger:
      description: >
        Ошибка пагинации: номера страниц и лимитов должны быть целыми числами
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              page:
                - "Номер страницы должен быть целым числом"

    ValidationIdsArray:
      description: >
        Ошибка списка идентификаторов (массив целых чисел / существование)
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              userIds:
                - "Каждое значение в userIds должно быть целым числом"
              courseIds:
                - "ID курса некорректен"

    ValidationGroupParent:
      description: >
        Ошибка структуры групп (родитель невалиден или зациклен)
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              parent_id:
                - "ID родительской группы некорректен"
                - "Родительская группа не может быть подгруппой текущей группы"

    ValidationTemplate:
      description: Ошибка валидации шаблона сертификата
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              name:
                - "Название не может быть пустым"
              file_id:
                - "Необходимо выбрать файл шаблона"

    ValidationCertificateItem:
      description: >
        Ошибка выдачи сертификатов по элементам списка
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              items.0.user_id:
                - "Пользователь не найден"
              items.0.course_id:
                - "Курс не найден"

    ValidationUserUpdate:
      description: Ошибка валидации при обновлении пользователя
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              email:
                - "Email должен быть корректным адресом"
              role:
                - "Указанная роль не существует"

    ValidationFileImportMissing:
      description: >
        Ошибка импорта пользователей — файл не загружен
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              fileImport:
                - "Файл не загружен"

    ValidationGroupDelete:
      description: >
        Ошибка удаления группы (есть дочерние группы)
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              id:
                - "Невозможно удалить группу, у которой есть дочерние группы"

    InternalError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              server:
                - "Internal server error. Try again later"

    TooManyRequests:
      description: Превышен лимит запросов
      headers:
        Retry-After:
          description: Через сколько секунд можно повторить запрос
          schema:
            type: integer
            example: 30
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/components/schemas/ErrorResponse'
          example:
            success: false
            errors:
              rate_limit:
                - "Превышен лимит запросов. Повторите через 30 секунд"
